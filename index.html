<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inventory Pro Mobile</title>
    <style>
        :root {
            --primary: #2563eb;
            --danger: #ef4444;
            --success: #22c55e;
            --bg: #f1f5f9;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 80px; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 15px; }
        
        h2 { font-size: 1rem; margin-top: 0; color: #475569; text-transform: uppercase; letter-spacing: 0.5px; }
        
        input, select, button { 
            width: 100%; padding: 14px; margin-bottom: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 16px; box-sizing: border-box;
        }

        .search-input {
            background-color: #fff; border: 2px solid var(--primary); margin-bottom: 15px;
            padding-left: 15px;
        }
        
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-post { background: var(--success); }
        .btn-csv { background: #64748b; font-size: 0.8rem; }
        .btn-del { background: #fee2e2; color: var(--danger); padding: 8px; width: auto; font-size: 0.7rem; margin: 0; border-radius: 6px; }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 350px; }
        th, td { text-align: left; padding: 12px 8px; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; }
        
        .low-stock { background: #fee2e2; color: #b91c1c; font-weight: bold; border-radius: 4px; padding: 2px 5px; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; border-top: 1px solid #e2e8f0; z-index: 100; }
        .nav-item { flex: 1; text-align: center; padding: 15px 5px; font-size: 0.7rem; color: #64748b; cursor: pointer; }
        .nav-item.active { color: var(--primary); font-weight: bold; border-top: 3px solid var(--primary); }

        .hist-item { border-left: 4px solid var(--primary); padding-left: 10px; margin-bottom: 10px; font-size: 0.8rem; }
        .hist-in { border-color: var(--success); }
        .hist-out { border-color: var(--danger); }
    </style>
</head>
<body>

    <h1 style="text-align:center; font-size: 1.2rem; color: var(--primary);">Inventory Pro Mobile</h1>

    <div id="tab-dash" class="tab-content active">
        <div class="card">
            <h2>Search Inventory</h2>
            <input type="text" id="searchInput" class="search-input" placeholder="Search code or description..." onkeyup="render()">
            <div class="table-container">
                <table id="invTable">
                    <thead><tr><th>Item</th><th>Qty</th><th>Status</th><th>Action</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="tab-move" class="tab-content">
        <div class="card">
            <h2>Record Movement</h2>
            <select id="move-code"></select>
            <select id="move-type">
                <option value="IN">Stock IN (+)</option>
                <option value="OUT">Stock OUT (-)</option>
            </select>
            <input type="number" id="move-qty" placeholder="Quantity" inputmode="numeric">
            <input type="text" id="move-inv" placeholder="Invoice # / Supplier">
            <input type="text" id="move-rem" placeholder="Remarks">
            <button class="btn-post" onclick="recordMovement()">Submit Movement</button>
        </div>
    </div>

    <div id="tab-hist" class="tab-content">
        <div class="card">
            <h2>Transaction History</h2>
            <div id="historyList"></div>
            <button class="btn-csv" onclick="clearHistory()" style="margin-top:10px; background:#ef4444;">Clear All History</button>
        </div>
    </div>

    <div id="tab-setup" class="tab-content">
        <div class="card">
            <h2>Add New Item</h2>
            <input type="text" id="m-code" placeholder="Item Code">
            <input type="text" id="m-desc" placeholder="Description">
            <input type="number" id="m-min" placeholder="Min Stock Level" inputmode="numeric">
            <button onclick="addItemMaster()">Create Item</button>
        </div>
        <div class="card">
            <h2>Data Tools</h2>
            <p style="font-size:0.7rem; color:#64748b;">CSV Order: Code, Desc, Min, Qty</p>
            <input type="file" id="csvFile" accept=".csv" class="btn-csv">
            <button class="btn-csv" onclick="importCSV()">Import CSV (4 Columns)</button>
            <button class="btn-csv" style="margin-top:5px;" onclick="exportInventory()">Export Inventory</button>
        </div>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="switchTab('tab-dash', this)">Levels</div>
        <div class="nav-item" onclick="switchTab('tab-move', this)">Move</div>
        <div class="nav-item" onclick="switchTab('tab-hist', this)">History</div>
        <div class="nav-item" onclick="switchTab('tab-setup', this)">Settings</div>
    </div>

<script>
    let inventory = JSON.parse(localStorage.getItem('mob_inv_master')) || [];
    let history = JSON.parse(localStorage.getItem('mob_inv_history')) || [];
    
    function switchTab(tabId, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        el.classList.add('active');
        if(tabId === 'tab-hist') renderHistory();
        render(); 
    }

    function saveData() {
        localStorage.setItem('mob_inv_master', JSON.stringify(inventory));
        localStorage.setItem('mob_inv_history', JSON.stringify(history));
        render();
    }

    function addItemMaster() {
        const code = document.getElementById('m-code').value.toUpperCase().trim();
        const desc = document.getElementById('m-desc').value.trim();
        const min = parseInt(document.getElementById('m-min').value);
        if(!code || isNaN(min)) return alert("Missing Info");
        if(inventory.find(i => i.code === code)) return alert("Exists!");
        inventory.push({ code, desc, min, qty: 0 });
        saveData();
        alert("Added!");
    }

    function recordMovement() {
        const code = document.getElementById('move-code').value;
        const type = document.getElementById('move-type').value;
        const qty = parseInt(document.getElementById('move-qty').value);
        const inv = document.getElementById('move-inv').value || "N/A";
        const rem = document.getElementById('move-rem').value || "-";

        if(!code || isNaN(qty)) return alert("Select item/qty");
        const item = inventory.find(i => i.code === code);
        item.qty = (type === 'IN') ? item.qty + qty : item.qty - qty;
        
        history.unshift({
            date: new Date().toLocaleString(),
            code, type, qty, inv, rem
        });

        saveData();
        alert("Posted!");
        document.getElementById('move-qty').value = '';
    }

    function render() {
        const tbody = document.querySelector('#invTable tbody');
        const select = document.querySelector('#move-code');
        const query = document.getElementById('searchInput').value.toLowerCase();
        tbody.innerHTML = '';
        select.innerHTML = '<option value="">-- Select Item --</option>';
        inventory.forEach(item => {
            if (item.code.toLowerCase().includes(query) || item.desc.toLowerCase().includes(query)) {
                const isLow = item.qty <= item.min;
                tbody.innerHTML += `<tr>
                    <td><strong>${item.code}</strong><br><small>${item.desc}</small></td>
                    <td>${item.qty}</td>
                    <td>${isLow ? '<span class="low-stock">LOW</span>' : 'OK'}</td>
                    <td><button class="btn-del" onclick="deleteItem('${item.code}')">üóëÔ∏è</button></td>
                </tr>`;
            }
            select.innerHTML += `<option value="${item.code}">${item.code}</option>`;
        });
    }

    function renderHistory() {
        const hList = document.getElementById('historyList');
        hList.innerHTML = history.length === 0 ? "No history yet." : "";
        history.slice(0, 50).forEach(h => {
            hList.innerHTML += `<div class="hist-item ${h.type==='IN'?'hist-in':'hist-out'}">
                <strong>${h.date} - ${h.code}</strong><br>
                ${h.type} ${h.qty} | Inv: ${h.inv}<br>
                <small>${h.rem}</small>
            </div>`;
        });
    }

    function deleteItem(code) { if(confirm(`Delete ${code}?`)) { inventory = inventory.filter(i => i.code !== code); saveData(); } }
    function clearHistory() { if(confirm("Clear logs?")) { history = []; saveData(); renderHistory(); } }

    function importCSV() {
        const file = document.getElementById('csvFile').files[0];
        if(!file) return alert("Select file");
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.split('\n');
            lines.forEach((line, i) => {
                const parts = line.split(',');
                if(parts.length >= 4) {
                    const code = parts[0].trim().toUpperCase();
                    if(!inventory.find(inv => inv.code === code) && code !== "CODE") {
                        inventory.push({ 
                            code: code, 
                            desc: parts[1].trim(), 
                            min: parseInt(parts[2]) || 0, 
                            qty: parseInt(parts[3]) || 0 
                        });
                    }
                }
            });
            saveData();
            alert("Imported with Quantities!");
        };
        reader.readAsText(file);
    }

    function exportInventory() {
        let csv = "Code,Description,Min,Qty\n";
        inventory.forEach(i => csv += `${i.code},${i.desc},${i.min},${i.qty}\n`);
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'inventory.csv'; a.click();
    }

    render();
</script>
</body>
</html>
